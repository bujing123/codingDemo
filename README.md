计划：涅槃


自学内容：
计算机三件套复习---csdn收藏；     100h.      8.2-8.8       	   8.16-8.23		9.13-9.19
1、计算机组成原理   b站王道计算机
2、计算机操作系统
3、计算机编译原理
4、数据结构与算法
5、计算机网络

前端html、css、javascript、vue     100h       7.16-7.29       8.30-9.5     	    9.20-9.26
git、maven、kafka、linux深度使用             30h         7.30-8.1
狂神基础复习                                      100h       8.9-8.15         8.24-8.29         9.6-9.12 

高级技术中间件：
DDD:领域驱动设计
EalsticSearch  clickhouse
JDDL 分库分表
消息队列 kafka rabbitmq
camel
定时引擎
jvm
设计模式
nginx
es

日程安排：
1、早上8.40-9.30   刷lc时间
2、9.30-10.00    根据上日整理，整理当日任务，并根据预估时间安排顺序，5分钟之内的事情立即解决，然后根据1、重要且紧急事情、2、重要的事情、3、紧急的事情、4、其他事情，顺序安排
3、10.00开始根据顺序解决当日任务，以30分钟为期限，每30分钟解决完一件事情
4、14.00至17.00继续执行当日任务
5、17.00至18.00，如果有上线任务，开始执行需要上线的任务
6、18.00-19.40 健身+吃饭
7、20.00 善后，没做完的任务完善一下

当天任务执行完成，就开始学习
学习路线：
1、首先复习计算机知识（上述五项）
2、面试技巧题复习
3、狂神教程基础复习
4、各种中间件复习
5、各种线上报警分析：https://cf.jd.com/pages/viewpage.action?pageId=657826559
6、总结学习、自身能力、开发的系统和代码


亮点：
1、jvm调优记录
2、复杂的导入需求（良品铺子、三只松鼠）
3、架构的设计（异步存数据库+es）
4、源码（需要学习）
总结各个接单系统的框架结构。
1、异步导单系统（良品铺子）
2、异步接单系统-物流开放平台
3、全量打印（10w以上）异步逻辑

学习方向： 网络七大层；  从原理方向、源码方向；京东hitech
1、性能相关
2、应用层  JVM
3、缓存层  redis、jimdb
4、数据层 数据库/es/clickhouse 分库分表 冷热库、分区；innodb源码
5、云方向：底层硬件部署 大数据



2024暂时提升目标
实践：
1、优化系统启动时间、
2、再优化一次日志收集+清理、
3、再优化一下jvm

慢sql优化：根据商家id和时间进行查询，每次查询出来后根据主键id往下查；
数据库死锁解决


学习：
1、mysql+jvm   https://juejin.cn/user/862486453028888/posts
2、了解运单号生成机制
3、spring内核



就是实践和理论的区别吧，一开始就想着实践一段时间，让自己有一定底蕴，这时候再研究理论，就能有更深层次的领悟。然后感觉互联网大公司的各类技术比较成熟和领先，所以这段时间我在外面学习了不少对于实践有用的新技术。就像是代码写的比较多以后，自己再去看一些计算机的底层知识，就会有很多深层次的领悟，比如计算机的执行、编译原理，都是逆波兰原则。

https://l.jd.com/student/map/player.du#/map-player?projectId=586709112&contentId=594590520&sessionId=0e24ea02a86b262b678604082f8f026d&init=true

http://xingyun.jd.com/shendeng/article/detail/33202?isHideShareButton=1&jdme_router=jdme%3A%2F%2Fweb%2F202206081297%3Furl%3Dhttp%3A%2F%2Fsd.jd.com%2Farticle%2F33202%3FisHideShareButton%3D1


项目、优化经验：
接单优化：
1、分批量同步转异步，拉上众多下游一起优化，避免重复接口调用
2、优化应用重启或者部署后，初始化慢导致刚开始的流量tp99较慢
3、优化死锁问题
设计模式解决问题
tp99从800ms优化到350ms内

1、饿了么多活https://zhuanlan.zhihu.com/p/32009822
2、cpu飙升：https://blog.csdn.net/Y0Q2T57s/article/details/129700581?spm=1001.2014.3001.5501
3、jvm优化：
解释执行优化：
应用启动时，cpu高而不满，打印cpu占用最高的线程，发现都是解释器的线程；
jvm启动的时候，会把代码编译为字节码，然后代码被第一次执行的话，类加载器会去找到对应的字节码文件，生成class文件，然后去验证准备解析完成后，就去初始化，初始化的时候会去static代码块之类的；
最后多次执行后，jvm会把这一部分代码当作热点代码，将代码由解释器解释为机器码提高效率，这里就是流量进来特别迅速，同时给大批代码解释，导致 cpu 暴高，最后通过提高解释线程数 + 压测预热解决

jvm死锁优化：
https://mp.weixin.qq.com/s/_tg_CTegsBeeOjKeZbM6SQ
有一次上线时，发现线程池被打满
想到：1、存在死循环 2、死锁 3、db es时间太长 4、负载不均衡导致
逐一排查线上流量情况、db等中间件情况发现都没问题，只能暂时下掉报警的机器，打印堆栈信息开始排查
发现特别多线程处于runnable状态，堆栈信息都是停留在相同地方，也不是阻塞状态，就开始很奇怪
然后拿着堆栈信息去看代码里面的类，发现是一个序列化方式的类，根据这个类的日志排查，发现存在异常的机器都是初始化失败了，其他机器都初始化成功了；
这个时候就更疑惑了，没办法继续看堆栈信息，发现有一个线程也停留在runnable状态，堆栈信息还处在clinit状态，说明正在初始化，去网上学习了一下初始化方面的内容，排查这个线程的整个父类的static代码块；
排查到这个线程在一个父类的static代码库会new第一个线程的父类；
因为学习到初始化过程中也会给类加锁，避免其他线程来初始化，这样子懒加载的话，由第一个加载的线程来初始化；所以开始怀疑是这个过程中导致了死锁；
因为线程1的父类在初始化的时候，父类的静态代码块中有线程2的父类；
线程2初始化过程中静态代码块中又有线程1的父类；因此怀疑是加载的时候拿到自己这边的初始化锁，然后开始等待对方释放锁导致的；
所以做出解决办法：放到spring中去启动的时候提前加载，不再懒加载；解决问题
消失的死锁：从 JSF 线程池满到 JVM 初始化原理剖析http://xingyun.jd.com/shendeng/article/detail/15233?forumId=72&jdme_router=jdme://web/202206081297?url%3Dhttp%3A%2F%2Fsd.jd.com%2Farticle%2F15233

log4j异步日志打印，大对象被打印的情况下，超长的char会在裁剪后，被丢弃在老年区不管，
导致次数多了后full GC
记一次疑似JVM内存泄漏的排查过程：http://xingyun.jd.com/shendeng/article/detail/31969?forumId=99&jdme_router=jdme://web/202206081297?url%3Dhttp%3A%2F%2Fsd.jd.com%2Farticle%2F31969

4、mysql优化：
时间未提交事务导致MySQL数据库CPU打满案例分析http://xingyun.jd.com/shendeng/article/detail/33668?isHideShareButton=1&jdme_router=jdme%3A%2F%2Fweb%2F202206081297%3Furl%3Dhttp%3A%2F%2Fsd.jd.com%2Farticle%2F33668%3FisHideShareButton%3D1

5、es排查
一次ES频繁YGC的排查之旅http://xingyun.jd.com/shendeng/article/detail/16154?forumId=99&jdme_router=jdme://web/202206081297?url%3Dhttp%3A%2F%2Fsd.jd.com%2Farticle%2F16154

6、秒杀系统:
京东自主中间件hotkey
https://gitee.com/bujing123/hotkey
cpu计算的 +1 的操作时间在皮秒级别，意思 一秒钟可以执行  10的10次方； 如果一台机器，热点商品一秒钟需要计算百万次，那么cpu使用率也才千分之一；因此这个中间件可以达到毫秒乃至纳秒级别的响应速度

复盘：
数据库死锁异常https://joyspace.jd.com/page/v4DyzFeSHPz9zoL8r8TI
http://xingyun.jd.com/shendeng/article/detail/14348?forumId=79&jdme_router=jdme://web/202206081297?url%3Dhttp%3A%2F%2Fsd.jd.com%2Farticle%2F14348
根本原因就是：
先查询或者先删除，又由于删除或者查询的数据不存在，一开始会对相关使用到的索引加next-key锁，若是唯一索引，则退化为普通的记录锁，但是若相关索引条件对应的记录不存在，则会退化为gap间隙锁，以保证可重复读的要求。而Gap Lock之间是可以共存的，不论是共享还是排他。
此时去insert的时候，就会两个事务去申请插入意向锁，就会进入互相等待对方事务释放gap锁的情况
重点：
两个事务都对不存在的行加上间隙锁，间隙锁会根据索引值来向左找比他小的，向右找比他大的，然后锁住这个范围；
在这个范围内插入的时候，会去尝试加插入意向锁，但是意向锁和间隙锁，不兼容，因此两个线程就会互相等待对方释放gap间隙锁，mysql就会检测到死锁


重复单号：https://joyspace.jd.com/pages/6qH0bSfRMk1uWhzITcXS
结转同步出现异常：https://joyspace.jd.com/page/QP3TwZxBvBC2r6CjImVL
黑马比赛：智能生成ops报告


做了哪些项目
什么什么项目，然后在这些项目上面自己是作为一个xxx地位，自己利用xx，做过xxx优化，得到了xxx效果，在双十一中自己又作为xxx地位，会去看xxx，主导压测，通过自己用一些公式去计算出来的线程数、机器数等等，以压测结果、线上实际数据、自己的预估结果一起估测系统的一个性能情况，然后再去评估系统在大促中的表现，再去看扩容、日志降级、限流什么的。


1、讲一讲你的工作、岗位、生活、学习 这段时间的一个经历。
2、你想去哪一家公司工作 希望做什么样的项目。
3、你的家庭在哪里，家人是否支持。
4、你要求的薪资为什么是XXX
5、大约多长时间可以入职

三年：
分第一年第二年第三年怎么讲
面试官你好，我叫李键屿，2021年毕业于北京邮电大学，今年25岁；毕业后我就来到了京东工作到现在；
刚入职后，岗位是后端研发，一开始负责的是京东物流这边的快递物流系统，并且在第一个双十一大促中就开始负责一些重点项目的大促保障，零事故的完成了目标，并在第一年获得年度最佳技术团队的表彰；
第二年开始就接手了一些重点系统的owner角色，并且在一些长期的核心项目里面作为一个主导的角色，比如我们这里系统的迁移，一些技术中间件的升级都是开始由我主导，在这个过程中，开始逐步做系统优化的事情，有像对于jvm解释器优化，避免了应用部署发生的cpu激增问题；拦截器监控做降级熔断的功能，并且发表了文章，获得了不少表彰；
第三年都熟练起来了，之后就开始主要做一些系统接口性能的优化呀，像是线程池爆满-jvm死锁的优化、mysql死锁的优化，并且根据这些优化加上自己的心得；写一些技术文章，发表专利、参加集团的比赛，并且对于我们的业务痛点，着重做了系统的重构，然后获得了不少的奖项；

hr面前：
每一次绩优+绩效A+奖章+奖励+价值观卡+比赛+文章+专利+技术分享，增加了部门影响力
把这些的每一次是为什么拿的都具象化

1、高并发 原子性，在多个线程同时操作一个变量时，一个判断过了条件，后面一个线程修改了这个变量，就会产生问题。

2、如何计算线程数配置？
|执行时间|并发|计算|原因|
|-|-|-|-|
|短|高|CPU+1|确保偶尔出现故障时，cpu不被浪费。减少上下文切换。|
|短|不高|CPU+1|确保偶尔出现故障时，cpu不被浪费。减少上下文切换。|
|长|高|CPU密集：CPU+1 IO密集：IO时间/CPU时间 * N|IO阻塞，CPU可以处理更多的任务|
|长|不高|CPU密集：CPU+1 IO密集：IO时间/CPU时间 * N|IO阻塞，CPU可以处理更多的任务|

3、如何评估机器数？
  机器数量 = tps/qps * tp99 / 线程数 + 1；
  ((机器数 - 1) / 机器数  *x min  x qpm + (60-min)  x qpm)/60  x* qpm . 
  ==> ((机器数-1)/机器数 x min + 60 - min)/60

4、如何评估 tp999；在机器随机出现故障。比如宿主机故障情况下，保证可用率在99.9%
一个机器一小时一直出故障，那么就是1000台机器；
机器出现3分钟故障的情况，÷20，那么五十台机器即可

cpu使用率计算：
工作时间 / 总时间  =  （1 - 空闲时间/总时间）* 100%
多线程优化代码：
1、不考虑cpu的情况下，计算一个任务可以多线程并发的最大线程情况
一个接口总耗时：1000ms；io时间：800ms；执行时间：200ms
那么io时间时，cpu是在等待io执行完毕的；此时可以新起四个线程  800ms/200ms = 4最大化节省时间

2、以4个线程为基准，计算cpu会多增的幅度
由上述cpu公式所得，1-cpu使用率 = 休息时间
假设当前cpu是20%，所以当前休息时间率是80%，
需要优化的线程，查看打点记录，tps是 50，tp99是 1000ms，其中800ms用于休息；设其他线程总共休息时间是x ms
可以得到方程式：（ 50 * 800 + x ）/ 1000*200 = 80 %
此时 x = 120000 ms的休息时间；
所以当线程起4的时候，此时cpu休息率就是  12w / 20w = 60%;
对应的cpu使用率就是 40%

3、根据当前cpu使用率判断是否符合业务要求，根据实际业务要求去增减线程，比如cpu使用率要求在30%内，就再 倒推可以节省的时间；得到最终的转异步线程数

4、最后决定是否扩容

5、因为实际jvm线程中，还有gc线程或者其他非业务线程存在，所以存在一定误差，最后一定要压测验证推算结果


如何确认数据库连接数是否超过数据库的承载能力

一个数据库连接会在mysql中栈空间创造一个几百kb的空间，存储查询结果、临时表这些信息；除了sql线程私有内存，还有共享内存，缓冲池，数据页索引页的数据；初估可以按照一个线程占用1M的私有内存空间；
线程数*1M < mysql总内存*20%


面试官你好，我叫李键屿，2021年毕业于北京邮电大学，今年25岁；毕业后我就来到了京东工作到现在；
分别以三年的工作内容来讲我的工作经历：
刚入职后，岗位是后端研发，一开始负责的是京东物流这边的快递物流系统，并且在第一个双十一大促中就开始独立负责一些重点项目的大促保障，零事故的完成了大促目标，并在第一年获得年度最佳技术团队的表彰；
第二年开始就接手了一些重点系统的负责人角色，并且在一些长期的核心项目里面作为一个主导的角色，比如我们这里系统的迁移，一些技术中间件的升级都是开始由我主导去完成，在这个过程中，开始逐步做系统优化的事情，像是去优化我们的接口性能，这个过程中我也是去协调沟通多个团队一起完成优化目标；
第三年都熟练起来了，之后就开始主要做一些系统接口性能、系统稳定的优化呀，像是线程池爆满-jvm死锁的优化、mysql死锁的优化，并且根据这些优化加上自己的心得；写一些技术文章，发表专利、参加集团的比赛，并且对于我们的业务痛点，着重做了系统的重构，然后获得了不少的奖项；

